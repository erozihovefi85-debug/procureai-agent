# 🧪 ProcureAI 完整功能测试指南

## 🚀 快速启动步骤

### 1️⃣ 检查 MongoDB 服务
```batch
# 运行服务状态检查
check-mongodb-service.bat
```

**期望结果：**
```
[OK] MongoDB 服务已安装
[OK] MongoDB 服务正在运行
[OK] MongoDB 连接成功
```

### 2️⃣ 测试 MongoDB 连接
```batch
# 测试数据库连接
test-mongodb-connection.bat
```

**期望结果：**
```
✓ MongoDB 连接成功！

数据库列表:
  - admin (XX KB)
  - config (XX KB)
  - local (XX KB)
  - procureai (XX KB)
```

### 3️⃣ 初始化数据库
```batch
# 初始化数据库（选择选项 3 完整初始化）
backend\db-init.bat
```

**选择 3（完整初始化）**

**期望结果：**
```
[OK] 管理员账户已更新
[OK] 测试用户已创建
[OK] 已创建 20 个测试用户

数据库统计:
  总用户数: 22
  Free 用户: X
  PLUS 用户: X
  PRO 用户: X
  ADMIN 用户: 1

重要账号信息:
管理员账号:
  邮箱: admin@procureai.com
  密码: admin123

测试账号:
  邮箱: test@procureai.com
  密码: 123456
```

### 4️⃣ 启动后端
```batch
# 启动后端服务
cd backend
npm run dev
```

**期望结果：**
```
✓ MongoDB Connected: 127.0.0.1

╔═══════════════════════════════════════════╗
║     ProcureAI Backend Server                ║
╠═══════════════════════════════════════════╣
║  Environment: development                     ║
║  Port: 3001                                  ║
╚═══════════════════════════════════════════╝

🚀 Server running at http://localhost:3001
```

### 5️⃣ 启动前端
```batch
# 启动前端服务
cd ..
npm run dev
```

**期望结果：**
```
VITE v6.x.x  ready in xxx ms

➜  Local:   http://localhost:5173/
```

---

## 🧪 完整功能测试

### 测试 1：基础功能测试

#### 1.1 访问首页
- 浏览器打开：http://localhost:5173
- ✅ 看到"AI采购助手"标题
- ✅ 看到两个大按钮（随心采购、规范采购）
- ✅ 看到粒子背景动画
- ✅ 看到客户公司 Logo 墙

#### 1.2 测试后端 API
- 浏览器打开：http://localhost:3001/api
- ✅ 看到 JSON 响应
- ✅ `status` 字段为 `"running"`

---

### 测试 2：用户认证测试

#### 2.1 注册新用户
1. 点击右上角"登录"按钮
2. 点击"立即注册"
3. 填写信息：
   - 用户名：`myuser`
   - 邮箱：`myuser@test.com`
   - 密码：`123456`
4. 点击"注册"

**期望结果：**
- ✅ 注册成功
- ✅ 自动登录
- ✅ 返回首页
- ✅ 右上角显示用户名 "myuser"

#### 2.2 登录测试
1. 点击右上角用户名
2. 点击"退出登录"
3. 再次点击"登录"
4. 使用刚注册的账号登录：
   - 邮箱：`myuser@test.com`
   - 密码：`123456`

**期望结果：**
- ✅ 登录成功
- ✅ 显示用户名 "myuser"

#### 2.3 管理员登录测试
1. 退出当前账号
2. 使用管理员账号登录：
   - 邮箱：`admin@procureai.com`
   - 密码：`admin123`

**期望结果：**
- ✅ 登录成功
- ✅ 显示用户名 "Admin"
- ✅ 侧边栏出现"管理后台"按钮

---

### 测试 3：随意采购功能测试（无需登录）

#### 3.1 基础对话
1. 点击首页"随心采购"按钮
2. 输入："帮我找一个好用的无线鼠标"
3. 点击发送

**期望结果：**
- ✅ AI 开始回复（流式输出）
- ✅ 看到打字机效果
- ✅ 回复内容关于鼠标推荐
- ✅ 消息显示在聊天区域

#### 3.2 上传文件对话
1. 点击附件图标（📎）
2. 选择一个图片或文档
3. 输入："帮我分析这个文件"
4. 点击发送

**期望结果：**
- ✅ 文件成功上传
- ✅ 在用户消息中显示文件
- ✅ AI 响应文件内容

#### 3.3 会话历史
1. 创建几条对话
2. 点击侧边栏"新建对话"
3. 在历史记录中选择之前的对话

**期望结果：**
- ✅ 历史对话记录显示在侧边栏
- ✅ 点击可以加载历史对话
- ✅ 消息内容完整

---

### 测试 4：规范采购功能测试（需要登录）

#### 4.1 需求澄清
1. 点击首页"规范采购"按钮
2. 选择"需求澄清"标签
3. 输入："我需要采购100台办公笔记本电脑，预算500元/台，要求i5处理器，8GB内存，256GB SSD"
4. 点击发送

**期望结果：**
- ✅ AI 提取需求关键信息
- ✅ 生成结构化需求清单
- ✅ 显示商品规格要求
- ✅ 标签页独立历史

#### 4.2 文档生成
1. 切换到"文档生成"标签
2. 输入："生成一份办公笔记本电脑采购需求文档"
3. 点击发送

**期望结果：**
- ✅ AI 生成标准采购文档
- ✅ 包含标题、编号、内容
- ✅ 可以下载生成的文档
- ✅ 标签页独立历史

#### 4.3 供应商匹配
1. 切换到"供应商匹配"标签
2. 输入："需要办公笔记本电脑供应商，要求有资质、有服务、价格合理"
3. 点击发送

**期望结果：**
- ✅ AI 推荐合适供应商
- ✅ 列出供应商信息
- ✅ 提供选择建议
- ✅ 标签页独立历史

#### 4.4 价格分析
1. 切换到"价格分析"标签
2. 输入："分析办公笔记本电脑市场价格"
3. 点击发送

**期望结果：**
- ✅ AI 分析价格趋势
- ✅ 提供价格区间
- ✅ 给出购买建议
- ✅ 标签页独立历史

---

### 测试 5：图片找同款功能测试（需要登录）

#### 5.1 单张图片搜索
1. 点击侧边栏"图片找同款"按钮
2. 上传一张商品图片
3. 点击"开始搜索"

**期望结果：**
- ✅ 图片预览显示
- ✅ 显示"搜索中..."状态
- ✅ 显示搜索结果列表
- ✅ 每个结果显示商品信息（价格、来源、相似度）
- ✅ 点击可以查看商品详情

#### 5.2 搜索历史
1. 进行多次图片搜索
2. 查看搜索历史区域

**期望结果：**
- ✅ 历史图片显示在页面底部
- ✅ 点击历史图片可以重新查看结果
- ✅ 显示搜索时间

---

### 测试 6：用户中心功能测试

#### 6.1 查看用户信息
1. 点击右上角用户名
2. 点击"用户中心"

**期望结果：**
- ✅ 显示用户信息（姓名、邮箱、角色、积分）
- ✅ 显示注册时间
- ✅ 显示会员类型

#### 6.2 退出登录
1. 点击"退出登录"按钮

**期望结果：**
- ✅ 退出成功
- ✅ 返回首页
- ✅ 右上角显示"登录"按钮

---

### 测试 7：管理后台功能测试（需要管理员权限）

#### 7.1 访问管理后台
1. 使用管理员账号登录
2. 点击侧边栏"管理后台"按钮

**期望结果：**
- ✅ 进入管理后台页面
- ✅ 显示管理界面

#### 7.2 数据统计仪表板
1. 查看"仪表板"标签

**期望结果：**
- ✅ 显示总用户数
- ✅ 显示活跃用户数
- ✅ 显示总会话数
- ✅ 显示总消息数
- ✅ 显示图片搜索次数
- ✅ 显示用户角色分布
- ✅ 显示会话模式分布

#### 7.3 用户管理
1. 切换到"用户管理"标签
2. 查看用户列表
3. 搜索用户
4. 编辑用户
5. 删除用户

**期望结果：**
- ✅ 显示所有用户列表
- ✅ 显示用户详细信息
- ✅ 搜索功能正常
- ✅ 编辑功能正常
- ✅ 删除功能正常
- ✅ 不同角色显示不同颜色标签

#### 7.4 会话管理
1. 切换到"会话管理"标签
2. 查看会话列表
3. 点击会话查看详情

**期望结果：**
- ✅ 显示所有会话列表
- ✅ 显示会话详细信息
- ✅ 显示用户信息
- ✅ 显示会话模式

#### 7.5 活动日志
1. 切换到"活动日志"标签
2. 查看系统活动

**期望结果：**
- ✅ 显示最近活动
- ✅ 显示活动类型（会话、消息、图片搜索）
- ✅ 显示时间戳
- ✅ 显示相关信息

---

## 📊 测试结果记录

### 测试清单

| 测试项 | 状态 | 备注 |
|--------|------|------|
| MongoDB 服务运行 | [ ] ✓ / ✗ | |
| MongoDB 连接成功 | [ ] ✓ / ✗ | |
| 数据库初始化成功 | [ ] ✓ / ✗ | |
| 后端服务启动成功 | [ ] ✓ / ✗ | |
| 前端服务启动成功 | [ ] ✓ / ✗ | |
| 访问首页成功 | [ ] ✓ / ✗ | |
| 后端 API 响应正常 | [ ] ✓ / ✗ | |
| 用户注册功能 | [ ] ✓ / ✗ | |
| 用户登录功能 | [ ] ✓ / ✗ | |
| 随意采购 - 基础对话 | [ ] ✓ / ✗ | |
| 随意采购 - 文件上传 | [ ] ✓ / ✗ | |
| 随意采购 - 会话历史 | [ ] ✓ / ✗ | |
| 规范采购 - 需求澄清 | [ ] ✓ / ✗ | |
| 规范采购 - 文档生成 | [ ] ✓ / ✗ | |
| 规范采购 - 供应商匹配 | [ ] ✓ / ✗ | |
| 规范采购 - 价格分析 | [ ] ✓ / ✗ | |
| 图片找同款 - 单张搜索 | [ ] ✓ / ✗ | |
| 图片找同款 - 搜索历史 | [ ] ✓ / ✗ | |
| 用户中心 - 查看信息 | [ ] ✓ / ✗ | |
| 用户中心 - 退出登录 | [ ] ✓ / ✗ | |
| 管理后台 - 数据统计 | [ ] ✓ / ✗ | |
| 管理后台 - 用户管理 | [ ] ✓ / ✗ | |
| 管理后台 - 会话管理 | [ ] ✓ / ✗ | |
| 管理后台 - 活动日志 | [ ] ✓ / ✗ | |

---

## 🆘 常见问题解决

### 问题 1：MongoDB 连接失败
**症状**：后端显示 `connect ECONNREFUSED`

**解决**：
```batch
# 1. 检查服务状态
sc query MongoDB

# 2. 如果停止，启动服务
net start MongoDB

# 3. 测试连接
test-mongodb-connection.bat
```

### 问题 2：前端无法连接后端
**症状**：浏览器 Network Error

**解决**：
1. 检查后端是否启动
2. 检查 `.env.local` 中的 `VITE_API_URL`
3. 应该是 `http://localhost:3001/api`
4. 清除浏览器缓存

### 问题 3：用户注册失败
**症状**：注册时返回错误

**解决**：
1. 检查 MongoDB 连接
2. 检查后端日志
3. 确认邮箱格式正确
4. 确认密码长度 ≥ 6

### 问题 4：Dify API 调用失败
**症状**：聊天时返回 `401 Unauthorized`

**解决**：
1. 检查 `backend/.env` 中的 Dify API Keys
2. 确认 API Keys 有效
3. 检查 Dify 服务状态

---

## 📝 测试账号信息

### 管理员账号
- 邮箱：`admin@procureai.com`
- 密码：`admin123`
- 角色：ADMIN
- 积分：999999

### 测试账号 1
- 邮箱：`test@procureai.com`
- 密码：`123456`
- 角色：PLUS
- 积分：500

### 测试账号 2-21
- 邮箱：`user1@test.com` 到 `user20@test.com`
- 密码：`123456`
- 角色：随机（Free/PLUS/PRO）
- 积分：随机

---

## ✅ 测试完成检查

在完成所有测试后，请确认：

- [ ] 所有测试项都已测试
- [ ] 所有功能都正常工作
- [ ] 无明显错误或异常
- [ ] 用户体验良好
- [ ] 性能表现良好

---

## 🎉 测试完成！

如果所有测试都通过，说明 ProcureAI 应用已经可以正常使用！

**下一步建议：**
1. 根据实际需求调整功能
2. 集成真实的图片搜索 API
3. 配置生产环境部署
4. 添加更多测试数据
5. 实施安全加固措施

---

**需要帮助？**
- 查看详细文档：`README_FULL.md`
- 查看快速指南：`QUICKSTART.md`
- 检查后端日志
- 检查浏览器控制台
